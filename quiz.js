const questions = [
    {
        question: "2 + 2 = ?",
        options: ["3", "4", "5", "6"],
        answer: "4"
    },
    {
        question: " 5 x 6 = ?",
        options: ["20", "25", "30", "35"],
        answer: "30"
    },
    {
        question: "4 + 4 = ?",
        options:["9","8","12","55"],
        answer:"8"
    },
    {
        question: "10 * 7 = ?",
        options:["9","8","70","55"],
        answer:"70"
    },
    {
        question: "9 x 4 = ?",
        options:["9","36","12","55"],
        answer:"36"
    },
   
        {
           question: "18 + 4 = ?",
           options: ['10', '22', '6', '2'],
           answer: "22"
       },
       
        {
           question: "10 + 8 = ?",
           options: ['28', '18', '28', '13'],
           answer: "18"
       },
       
        {
           question: "7 + 12 = ?",
           options: ['19', '28', '40', '37'],
           answer: "19"
       },
       
        {
           question: "8 x 8 = ?",
           options: ['46', '26', '64', '16'],
           answer: "64"
       },
       
        {
           question: "13 + 11 = ?",
           options: ['29', '28', '24', '37'],
           answer: "24"
       },
       
        {
           question: "8 x 4 = ?",
           options: ['32', '58', '45', '65'],
           answer: "32"
       },
       
        {
           question: "3 x 6 = ?",
           options: ['56', '57', '60', '18'],
           answer: "18"
       },
       
        {
           question: "20 + 19 = ?",
           options: ['20', '39', '12', '15'],
           answer: "39"
       },
       
        {
           question: "5 x 8 = ?",
           options: ['40', '11', '51', '7'],
           answer: "40"
       },
       
        {
           question: "9 x 7 = ?",
           options: ['3', '63', '43', '87'],
           answer: "63"
       },
       
        {
           question: "2 + 5 = ?",
           options: ['7', '6', '24', '29'],
           answer: "7"
       },
       
        {
           question: "12 + 19 = ?",
           options: ['22', '31', '4', '37'],
           answer: "31"
       },
       
        {
           question: "3 + 12 = ?",
           options: ['15', '16', '31', '18'],
           answer: "15"
       },
       
        {
           question: "8 x 5 = ?",
           options: ['19', '40', '92', '56'],
           answer: "40"
       },
       
        {
           question: "3 x 10 = ?",
           options: ['30', '34', '86', '90'],
           answer: "30"
       },
       
        {
           question: "9 x 2 = ?",
           options: ['24', '85', '18', '38'],
           answer: "18"
       },
       
        {
           question: "1 + 19 = ?",
           options: ['15', '3', '20', '22'],
           answer: "20"
       },
       
        {
           question: "7 x 4 = ?",
           options: ['21', '56', '28', '11'],
           answer: "28"
       },
       
        {
           question: "8 x 4 = ?",
           options: ['18', '32', '85', '35'],
           answer: "32"
       },
       
        {
           question: "1 x 9 = ?",
           options: ['44', '22', '9', '84'],
           answer: "9"
       },
       
        {
           question: "20 + 11 = ?",
           options: ['15', '31', '25', '23'],
           answer: "31"
       },
       
        {
           question: "4 x 4 = ?",
           options: ['40', '43', '16', '20'],
           answer: "16"
       },
       
        {
           question: "15 + 18 = ?",
           options: ['31', '1', '33', '10'],
           answer: "33"
       },
       
        {
           question: "12 + 17 = ?",
           options: ['26', '4', '29', '17'],
           answer: "29"
       },
       
        {
           question: "3 + 7 = ?",
           options: ['33', '10', '14', '20'],
           answer: "10"
       },
       
        {
           question: "5 x 5 = ?",
           options: ['96', '32', '13', '25'],
           answer: "25"
       },
       
        {
           question: "5 x 8 = ?",
           options: ['40', '10', '83', '23'],
           answer: "40"
       },
       
        {
           question: "8 x 3 = ?",
           options: ['100', '95', '41', '24'],
           answer: "24"
       },
       
        {
           question: "5 x 2 = ?",
           options: ['64', '22', '10', '31'],
           answer: "10"
       },
       
        {
           question: "1 x 8 = ?",
           options: ['71', '8', '22', '1'],
           answer: "8"
       },
       
        {
           question: "1 + 11 = ?",
           options: ['20', '18', '12', '24'],
           answer: "12"
       },
       
        {
           question: "1 + 14 = ?",
           options: ['13', '15', '26', '11'],
           answer: "15"
       },
       
        {
           question: "7 x 1 = ?",
           options: ['25', '17', '81', '7'],
           answer: "7"
       },
       
        {
           question: "18 + 9 = ?",
           options: ['5', '39', '34', '27'],
           answer: "27"
       },
       
        {
           question: "16 + 15 = ?",
           options: ['31', '10', '37', '34'],
           answer: "31"
       },
       
        {
           question: "15 + 8 = ?",
           options: ['3', '4', '34', '23'],
           answer: "23"
       },
       
        {
           question: "1 x 5 = ?",
           options: ['59', '33', '52', '5'],
           answer: "5"
       },
       
        {
           question: "15 + 20 = ?",
           options: ['32', '13', '30', '35'],
           answer: "35"
       },
       
        {
           question: "13 + 11 = ?",
           options: ['20', '24', '2', '19'],
           answer: "24"
       },
       
        {
           question: "1 + 1 = ?",
           options: ['2', '30', '2', '2'],
           answer: "2"
       },
       
        {
           question: "10 x 7 = ?",
           options: ['36', '70', '3', '30'],
           answer: "70"
       },
       
        {
           question: "14 + 1 = ?",
           options: ['15', '8', '30', '30'],
           answer: "15"
       },
       
        {
           question: "6 x 8 = ?",
           options: ['48', '76', '87', '46'],
           answer: "48"
       },
       
        {
           question: "7 x 7 = ?",
           options: ['49', '37', '41', '70'],
           answer: "49"
       },
       
        {
           question: "9 + 9 = ?",
           options: ['3', '18', '24', '3'],
           answer: "18"
       },
       
        {
           question: "9 x 10 = ?",
           options: ['33', '90', '58', '66'],
           answer: "90"
       },
       
        {
           question: "5 x 1 = ?",
           options: ['90', '89', '29', '5'],
           answer: "5"
       },
       
        {
           question: "2 + 1 = ?",
           options: ['26', '7', '40', '3'],
           answer: "3"
       },
       
        {
           question: "18 + 20 = ?",
           options: ['21', '38', '9', '3'],
           answer: "38"
       },
       
        {
           question: "8 x 10 = ?",
           options: ['80', '82', '60', '4'],
           answer: "80"
       },
       
        {
           question: "10 + 6 = ?",
           options: ['11', '1', '16', '29'],
           answer: "16"
       },
       
        {
           question: "4 x 6 = ?",
           options: ['19', '60', '24', '61'],
           answer: "24"
       },
       
        {
           question: "1 x 3 = ?",
           options: ['40', '51', '3', '49'],
           answer: "3"
       },
       
        {
           question: "2 x 7 = ?",
           options: ['32', '41', '72', '14'],
           answer: "14"
       },
       
        {
           question: "9 x 1 = ?",
           options: ['71', '9', '11', '77'],
           answer: "9"
       },
       
        {
           question: "9 + 17 = ?",
           options: ['12', '33', '7', '26'],
           answer: "26"
       },
       
        {
           question: "6 + 5 = ?",
           options: ['11', '2', '16', '16'],
           answer: "11"
       },
       
        {
           question: "2 x 3 = ?",
           options: ['55', '37', '62', '6'],
           answer: "6"
       },
       
        {
           question: "9 + 6 = ?",
           options: ['32', '35', '15', '9'],
           answer: "15"
       },
       
        {
           question: "12 + 17 = ?",
           options: ['12', '5', '20', '29'],
           answer: "29"
       },
       
        {
           question: "9 + 20 = ?",
           options: ['1', '29', '10', '1'],
           answer: "29"
       },
       
        {
           question: "1 x 10 = ?",
           options: ['67', '10', '97', '32'],
           answer: "10"
       },
       
        {
           question: "3 x 8 = ?",
           options: ['17', '89', '47', '24'],
           answer: "24"
       },
       
        {
           question: "1 x 8 = ?",
           options: ['8', '57', '55', '29'],
           answer: "8"
       },
       
        {
           question: "5 x 9 = ?",
           options: ['61', '45', '23', '9'],
           answer: "45"
       },
       
        {
           question: "5 x 10 = ?",
           options: ['8', '50', '64', '27'],
           answer: "50"
       },
       
        {
           question: "19 + 12 = ?",
           options: ['28', '21', '31', '33'],
           answer: "31"
       },
       
        {
           question: "10 x 5 = ?",
           options: ['90', '50', '78', '42'],
           answer: "50"
       },
       
        {
           question: "18 + 9 = ?",
           options: ['31', '10', '20', '27'],
           answer: "27"
       },
       
        {
           question: "10 + 10 = ?",
           options: ['20', '11', '27', '21'],
           answer: "20"
       },
       
        {
           question: "12 + 18 = ?",
           options: ['17', '20', '27', '30'],
           answer: "30"
       },
       
        {
           question: "3 + 18 = ?",
           options: ['34', '28', '12', '21'],
           answer: "21"
       },
       
        {
           question: "16 + 3 = ?",
           options: ['39', '19', '5', '14'],
           answer: "19"
       },
       
        {
           question: "14 + 7 = ?",
           options: ['38', '14', '21', '18'],
           answer: "21"
       },
       
        {
           question: "9 x 5 = ?",
           options: ['85', '45', '86', '64'],
           answer: "45"
       },
       
        {
           question: "6 x 5 = ?",
           options: ['30', '93', '31', '7'],
           answer: "30"
       },
       
        {
           question: "15 + 17 = ?",
           options: ['13', '7', '25', '32'],
           answer: "32"
       },
       
        {
           question: "9 + 15 = ?",
           options: ['29', '24', '1', '2'],
           answer: "24"
       },
       
        {
           question: "7 x 10 = ?",
           options: ['70', '23', '88', '24'],
           answer: "70"
       },
       
        {
           question: "9 x 3 = ?",
           options: ['78', '27', '100', '82'],
           answer: "27"
       },
       
        {
           question: "6 x 9 = ?",
           options: ['79', '21', '53', '54'],
           answer: "54"
       },
       
        {
           question: "6 x 7 = ?",
           options: ['19', '47', '16', '42'],
           answer: "42"
       },
       
        {
           question: "3 + 6 = ?",
           options: ['9', '33', '23', '11'],
           answer: "9"
       },
       
        {
           question: "8 x 4 = ?",
           options: ['93', '74', '32', '99'],
           answer: "32"
       },
       
        {
           question: "13 + 8 = ?",
           options: ['13', '21', '21', '5'],
           answer: "21"
       },
       
        {
           question: "2 x 8 = ?",
           options: ['16', '39', '10', '49'],
           answer: "16"
       },
       
        {
           question: "1 + 1 = ?",
           options: ['23', '2', '40', '27'],
           answer: "2"
       },
       
        {
           question: "17 + 15 = ?",
           options: ['32', '10', '3', '17'],
           answer: "32"
       },
       
        {
           question: "10 x 7 = ?",
           options: ['89', '32', '70', '26'],
           answer: "70"
       },
       
        {
           question: "3 x 6 = ?",
           options: ['17', '70', '18', '35'],
           answer: "18"
       },
       
        {
           question: "7 x 10 = ?",
           options: ['5', '70', '99', '91'],
           answer: "70"
       },
       
        {
           question: "7 + 5 = ?",
           options: ['12', '5', '18', '30'],
           answer: "12"
       },
       
        {
           question: "20 + 1 = ?",
           options: ['12', '21', '34', '1'],
           answer: "21"
       },
       
        {
           question: "17 + 5 = ?",
           options: ['2', '22', '10', '38'],
           answer: "22"
       },
       
        {
           question: "2 x 9 = ?",
           options: ['10', '35', '18', '3'],
           answer: "18"
       },
       
        {
           question: "4 x 9 = ?",
           options: ['41', '29', '52', '36'],
           answer: "36"
       },
       
        {
           question: "18 + 6 = ?",
           options: ['24', '2', '32', '20'],
           answer: "24"
       },
       
        {
           question: "5 x 10 = ?",
           options: ['64', '50', '80', '13'],
           answer: "50"
       },
       
        {
           question: "8 + 15 = ?",
           options: ['4', '23', '21', '6'],
           answer: "23"
       },
       
        {
           question: "4 + 12 = ?",
           options: ['16', '37', '5', '28'],
           answer: "16"
       },
       
    
    // We Can Add more questions here ... 
];
 
 //shuffle the question pattern
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

let currentQuestion = 0;
let score = 0;
let timer;
let userName = null; // Initialize userName as null
let hasClickedStartButton = false;
let userInteracted = false; 

//clear cache 
function clearUserNameFromLocalStorage(){
    localStorage.removeItem("userName");
    userName = null;
}



document.addEventListener("DOMContentLoaded", () => {
    const startScreen = document.getElementById("start-screen");
    const quizScreen = document.getElementById("quiz-screen");
    const startButton = document.getElementById("start-button");
    const questionContainer = document.getElementById("question-container");
    const timerDisplay = document.getElementById("timer");
    const resultDisplay = document.getElementById("result");
    const optionsContainer = document.getElementById("options-container");
    const buttonClickSound = document.getElementById("buttonClickSound");
    const timerCompletionSound = document.getElementById("bellSound");
    const restartButton = document.getElementById("restart-button");
    document.addEventListener("click", () => {
        userInteracted = true;
    });
     restartButton.addEventListener("click",()=>{
        localStorage.removeItem("userName");
        userName = null;

        currentQuestion = 0;
        score = 0;
        location.reload();          
    });

    startButton.addEventListener("click", () => {
        buttonClickSound.play();
        
    });
    
     
   

    function stopAudio() {
        timerCompletionSound.pause();
        timerCompletionSound.currentTime = 0;
    }
    if(timerCompletionSound){
        timerCompletionSound.addEventListener("ended", stopAudio);
    }

    
    // Check if the user's name is already in localStorage
    const storedUserName = localStorage.getItem("userName");
    if (storedUserName) {
        userName = storedUserName;
        hasClickedStartButton = true; // Set the flag to true
        startScreen.style.display = "none";
        quizScreen.style.display = "block";
        document.getElementById("user-name").textContent = userName;
        startQuiz();
    }

    startButton.addEventListener("click", () => {
        buttonClickSound.play(); 
        if (!hasClickedStartButton) {
            userName = prompt("Enter your Name");
            if (!userName) {
                alert("Please Enter Your Name :");
                return;
            }
            hasClickedStartButton = true; // Set the flag to true
            localStorage.setItem("userName", userName);
            setTimeout( ()=>{
                clearUserNameFromLocalStorage();
                alert("User Name cleared from Cache !");
                console.log("Cache cleared.");
            },62000); //60 seconds
        }
        startScreen.style.display = "none";
        quizScreen.style.display = "block";
        document.getElementById("user-name").textContent = userName;
        startQuiz();

      
    });


    function startQuiz() {
        shuffleArray(questions);
        // userName = prompt("Enter Your Name :");
        // if(!userName){
        //     alert("Please Enter your name");
        //     return;
        // }
        document.getElementById("user-name").textContent = userName;
        displayQuestion();
        timer = setInterval(updateTimer, 1000);
    }

    function displayQuestion() {
        if (currentQuestion < questions.length) {
            const questionData = questions[currentQuestion];
            document.getElementById("question").textContent = questionData.question;
            optionsContainer.innerHTML = "";

            questionData.options.forEach((option) => {
                const optionButton = document.createElement("button");
                optionButton.textContent = option;
                optionButton.classList.add("options-button");
                optionButton.addEventListener("click", () => checkAnswer(option,questionData.answer));
                optionsContainer.appendChild(optionButton);
            });
        } else {
            clearInterval(timer);
            questionContainer.style.display = "none";
            resultDisplay.style.display = "block";
            questionContainer.innerHTML = "Quiz completed!";
            resultDisplay.innerHTML = `Congratulations, ${userName}! Your score: ${currentQuestion} / ${questions.length}`;

            


            // need to send this data to node.js server if i want.
        }
    }

    function updateTimer() {
        let timeLeft = parseInt(timerDisplay.textContent);
        if (timeLeft <= 0) {
            questionContainer.style.display = "none";
            resultDisplay.style.display = "block";
            resultDisplay.innerHTML = `Time's up, ${userName}! Your score: ${score} `;
            // Completion Sound;
            if(userInteracted){
                timerCompletionSound.play();

            }
            if(score > 30){
                resultDisplay.innerHTML += `You are eligible for a Crackers!🧨`;

            }
            restartButton.style.display = "block";
            // also send this data to node js server.
        } else {
            timeLeft--;
            timerDisplay.textContent = timeLeft;
        }
    }

    function checkAnswer(selectedOption) {
        // console.log(`Selected Option: ${selectedOption}, Correct Answer: ${correctAnswer}`);
        const correctAnswer = questions[currentQuestion].answer;
        buttonClickSound.play();

        if(selectedOption === correctAnswer){
            score++;
            console.log(`Score updated: ${score}`);
        }

        currentQuestion++;
        displayQuestion();

        //Update the score display on Menu
        const scoreDisplay = document.getElementById("score-display");
        scoreDisplay.textContent = `Score: ${score}`;
      
    }

    // startQuiz();
});
